<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Beneficio Progresivo ¬∑ BET300</title>
<meta name="theme-color" content="#0b0f18"/>

<style>
:root{
  --bg:#070b12;
  --panel:#0c1220;
  --panel2:#0a101d;
  --border:rgba(255,255,255,.10);

  --text:#eaf0ff;
  --muted:#a8b0c7;
  --muted2:#7d86a3;

  --gold:#f6d27b;
  --gold2:#caa24f;

  --ok:#25D366;

  /* Bot√≥n rojo brillante */
  --red1:#ff2e2e;
  --red2:#ff4d4d;

  --glass: rgba(10,14,22,.55);
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  color:var(--text);
  font:16px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background: radial-gradient(900px 500px at 30% -10%, rgba(255,46,46,.16), transparent 60%),
              radial-gradient(700px 420px at 80% 0%, rgba(246,210,123,.10), transparent 60%),
              radial-gradient(900px 650px at 50% 120%, rgba(80,140,255,.10), transparent 60%),
              linear-gradient(180deg, #070b12 0%, #070b12 65%, #050810 100%);
  overflow-x:hidden;
}

/* Part√≠culas premium (suave) */
.fxParticles{
  position:fixed; inset:0; z-index:-1; pointer-events:none;
  background:
    radial-gradient(circle at 10% 20%, rgba(255,255,255,.06) 0 2px, transparent 3px),
    radial-gradient(circle at 25% 60%, rgba(255,255,255,.05) 0 2px, transparent 3px),
    radial-gradient(circle at 60% 30%, rgba(255,255,255,.05) 0 2px, transparent 3px),
    radial-gradient(circle at 80% 70%, rgba(255,255,255,.06) 0 2px, transparent 3px);
  filter: blur(.2px);
  opacity:.75;
}
.snow{
  position:fixed; inset:0; z-index:-1; pointer-events:none; opacity:.45;
}
.snow i{
  position:absolute; top:-20px;
  width:6px; height:6px; border-radius:50%;
  background:rgba(255,255,255,.55);
  filter: blur(.2px);
  animation: fall linear forwards;
}
@keyframes fall{
  0%{ transform:translateY(-20px); opacity:0; }
  12%{ opacity:.9; }
  100%{ transform:translateY(110vh); opacity:0; }
}

.container{max-width:980px;margin:10px auto 110px;padding:0 12px}
.card{
  background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)), var(--glass);
  border:1px solid var(--border);
  border-radius:22px;
  padding:12px;
  box-shadow: 0 18px 60px rgba(0,0,0,.50);
  backdrop-filter: blur(10px);
}

/* Header 1 l√≠nea */
.headerRow{
  display:flex; align-items:center; gap:10px;
  padding:8px 8px 10px;
}
.logo{
  width:92px; height:56px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.18);
  box-shadow: 0 14px 36px rgba(0,0,0,.48);
  overflow:hidden;
  display:flex; align-items:center; justify-content:center;
  flex: 0 0 auto;
}
.logo img{
  width:100%; height:100%;
  object-fit:contain;
  padding:3px;
  display:block;
  filter: drop-shadow(0 8px 12px rgba(0,0,0,.55)) saturate(1.12) contrast(1.06);
}

.headerRight{
  margin-left:auto;
  display:flex; align-items:center; gap:8px; flex-wrap:nowrap;
}
.pill{
  display:inline-flex; align-items:center; gap:8px;
  padding:8px 10px;
  border-radius:999px;
  font-size:13px;
  color:var(--muted);
  background: rgba(0,0,0,.18);
  border:1px solid rgba(255,255,255,.10);
}
.count{
  display:inline-flex; align-items:center; justify-content:center;
  min-width:86px;
  font-variant-numeric:tabular-nums;
  padding:4px 10px;
  border-radius:999px;
  background: rgba(246,210,123,.10);
  border:1px solid rgba(246,210,123,.25);
  color:#ffe7a8;
  font-weight:800;
}
.pillBtn{
  cursor:pointer; user-select:none;
}
.pillBtn:hover{filter:brightness(1.06)}
.pill b{color:#dfe6ff}

.subline{
  padding:0 8px 6px;
  color:var(--muted2);
  font-size:12px;
  letter-spacing:.16em;
  text-transform:uppercase;
}

/* Layout */
.grid{display:grid; gap:12px}
@media(min-width:920px){
  .grid{grid-template-columns:1.12fr .88fr}
}
.panel{
  border:1px solid rgba(255,255,255,.10);
  background: rgba(0,0,0,.18);
  border-radius:18px;
  padding:14px;
}
h1{margin:0 0 6px;font-size:30px;letter-spacing:.2px}
h2{margin:0 0 6px;font-size:18px}
p{margin:0 0 10px;color:var(--muted)}
.small{font-size:12px;color:var(--muted2)}

/* Bloques internos */
.box{
  border:1px solid rgba(255,255,255,.10);
  border-radius:16px;
  padding:12px;
  background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.015));
}
.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.rowBetween{display:flex;justify-content:space-between;gap:10px;align-items:center}
.k{color:var(--muted2);font-size:12px;text-transform:uppercase;letter-spacing:.14em}
.v{font-weight:900;font-size:26px}

/* Selector escala */
.scaleTabs{display:flex;gap:8px;margin-top:10px}
.tab{
  flex:1;
  padding:10px 12px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background: rgba(0,0,0,.18);
  color:#dfe6ff;
  font-weight:800;
  cursor:pointer;
  text-align:center;
}
.tab.active{
  background: linear-gradient(180deg, rgba(246,210,123,.18), rgba(246,210,123,.08));
  border-color: rgba(246,210,123,.30);
  color:#ffe7a8;
}

/* Barra progreso */
.meter{
  margin-top:10px;
  height:12px;
  border-radius:999px;
  background: rgba(255,255,255,.07);
  border:1px solid rgba(255,255,255,.10);
  overflow:hidden;
}
.meter > i{
  display:block; height:100%; width:0%;
  background: linear-gradient(90deg, rgba(246,210,123,.30), rgba(255,46,46,.35));
  border-right: 1px solid rgba(255,255,255,.25);
  box-shadow: 0 0 18px rgba(255,46,46,.20);
}

/* Inputs */
input[type="range"]{width:100%}
.amountPills{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
.apill{
  padding:8px 10px;border-radius:999px;cursor:pointer;
  border:1px solid rgba(255,255,255,.10);
  background: rgba(0,0,0,.16);
  color:#dfe6ff; font-weight:800; font-size:13px;
}
.apill:hover{filter:brightness(1.06)}

/* Botones inferiores */
.dock{
  position:fixed; left:0; right:0; bottom:0; z-index:30;
  padding:10px 12px 12px;
  background: linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(5,7,12,.72) 22%, rgba(5,7,12,.92) 100%);
  display:grid;
  gap:10px;
}
.btn{
  appearance:none; border:none; cursor:pointer;
  padding:14px 16px;
  border-radius:16px;
  font-weight:900;
  letter-spacing:.2px;
  color:#081018;
  background: rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.10);
  box-shadow: 0 16px 30px rgba(0,0,0,.40);
  transition: transform .08s ease, filter .08s ease;
}
.btn:hover{transform: translateY(-1px); filter: brightness(1.05)}
.btn:active{transform: translateY(0)}
.btn:disabled{opacity:.55; cursor:not-allowed}

.btnPrimary{
  background: linear-gradient(90deg, rgba(246,210,123,.95), rgba(202,162,79,.95));
  color:#130b00;
}
.btnWA{
  background: var(--ok);
  color:#06120a;
}
.btnEnter{
  background: linear-gradient(90deg, var(--red1), var(--red2));
  color:#180000;
}

/* Modal */
.modal{
  position:fixed; inset:0; display:none;
  align-items:center; justify-content:center;
  background: rgba(0,0,0,.62);
  backdrop-filter: blur(6px);
  z-index:60;
  padding:14px;
}
.modal.show{display:flex}
.modalCard{
  width:min(520px, 94vw);
  border-radius:18px;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(8,12,18,.85);
  box-shadow: 0 22px 70px rgba(0,0,0,.60);
  padding:14px;
}
.modalHead{display:flex;gap:10px;align-items:center}
.modalHead h3{margin:0;font-size:18px}
.closeX{margin-left:auto;cursor:pointer;opacity:.85}
.closeX:hover{opacity:1}
.modalBody{margin-top:10px;display:grid;gap:10px}
.mRow{
  display:flex;justify-content:space-between;gap:10px;align-items:center;
  border:1px dashed rgba(255,255,255,.16);
  border-radius:14px;
  padding:10px 12px;
}
.code{
  font-weight:1000;
  letter-spacing:.12em;
  font-variant-numeric:tabular-nums;
}
.mActions{display:flex;gap:8px;flex-wrap:wrap}
.mActions .btn{flex:1}

.toast{
  position:fixed; left:50%; transform:translateX(-50%);
  bottom:96px; z-index:80;
  background: rgba(0,0,0,.65);
  border:1px solid rgba(255,255,255,.12);
  color:#eaf0ff;
  padding:10px 12px;
  border-radius:999px;
  font-size:13px;
  display:none;
}

/* Mobile ajustes */
@media(max-width:420px){
  .container{margin:8px auto 120px}
  .logo{width:84px;height:52px}
  h1{font-size:26px}
  .pill{font-size:12px;padding:7px 9px}
  .count{min-width:78px}
}
</style>
</head>

<body>
<div class="fxParticles"></div>
<div id="snow" class="snow" aria-hidden="true"></div>

<div class="toast" id="toast">Copiado ‚úÖ</div>

<!-- MODAL -->
<div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="mTitle">
  <div class="modalCard">
    <div class="modalHead">
      <h3 id="mTitle">‚úÖ C√≥digo generado</h3>
      <span class="closeX" id="mCloseX">‚úñ</span>
    </div>

    <div class="modalBody">
      <div class="mRow"><span class="k">Beneficio</span><span class="v" id="mBenefit">‚Äî</span></div>
      <div class="mRow"><span class="k">Monto</span><span class="v" id="mAmount">‚Äî</span></div>
      <div class="mRow"><span class="k">C√≥digo</span><span class="code" id="mCode">‚Äî</span></div>
      <div class="mRow"><span class="k">Fecha/Hora</span><span class="v" id="mTs">‚Äî</span></div>

      <div class="mActions">
        <button class="btn btnPrimary" id="copyBtn">üìã Copiar c√≥digo</button>
        <button class="btn btnWA" id="mWA">üì≤ Reclamar por WhatsApp</button>
        <button class="btn btnEnter" id="mEnter">üéÆ Entrar a la plataforma</button>
      </div>

      <div class="small">
        Nota: 1 chance por d√≠a. Sujeto a validaci√≥n operativa. No reemplaza reglas internas de acreditaci√≥n.
      </div>
    </div>
  </div>
</div>

<div class="container">
  <div class="card">

    <!-- Header 1 l√≠nea -->
    <div class="headerRow">
      <div class="logo" aria-label="Logo">
        <!-- ‚úÖ Reemplaz√° logo.svg por tu SVG navide√±o (o PNG) -->
        <img id="logoImg" src="logo.svg" alt="Logo BET300"/>
      </div>

      <div class="headerRight">
        <span class="pill">‚è≥ <span class="count" id="countdown">--:--</span></span>
        <span class="pill pillBtn" id="soundToggle">üîä <b id="soundState">ON</b></span>
      </div>
    </div>

    <!-- Subline (sin BET300 escrito grande) -->
    <div class="subline">beneficio progresivo</div>

    <div class="grid">
      <!-- LEFT -->
      <div class="panel">
        <h1>Eleg√≠ tu nivel</h1>
        <p>Seleccion√° un monto, mir√° el beneficio estimado y gener√° tu c√≥digo. Despu√©s pod√©s <b>reclamar por WhatsApp</b> o entrar directo a la plataforma.</p>

        <div class="box">
          <div class="rowBetween">
            <div>
              <div class="k">Monto seleccionado</div>
              <div class="v" id="amountLabel">$ 10.000</div>
              <div class="small">Ajustalo seg√∫n el usuario</div>
            </div>
            <div style="text-align:right">
              <div class="k">Beneficio estimado</div>
              <div class="v" id="benefitLabel">+20%</div>
              <div class="small" id="tierLine">Nivel Base</div>
            </div>
          </div>

          <div class="meter" aria-label="Progreso del beneficio">
            <i id="meterFill"></i>
          </div>

          <div style="margin-top:12px">
            <input id="amountRange" type="range" min="5000" max="200000" step="5000" value="10000"/>
            <div class="amountPills">
              <button class="apill" data-amt="5000">$5.000</button>
              <button class="apill" data-amt="10000">$10.000</button>
              <button class="apill" data-amt="20000">$20.000</button>
              <button class="apill" data-amt="50000">$50.000</button>
              <button class="apill" data-amt="100000">$100.000</button>
            </div>
          </div>

          <div class="scaleTabs" role="tablist" aria-label="Escala">
            <button class="tab active" data-tier="base" role="tab">Base</button>
            <button class="tab" data-tier="pro" role="tab">Pro</button>
            <button class="tab" data-tier="elite" role="tab">Elite</button>
          </div>

          <div class="box" style="margin-top:12px">
            <div class="k">Condici√≥n</div>
            <div style="margin-top:6px" class="small" id="condLine">
              1 chance por d√≠a ¬∑ Se genera un c√≥digo de activaci√≥n ¬∑ El beneficio se acredita con la pr√≥xima carga.
            </div>
          </div>
        </div>

      </div>

      <!-- RIGHT -->
      <div class="panel">
        <h2>Estado del d√≠a</h2>
        <div class="box">
          <div class="rowBetween">
            <div>
              <div class="k">Disponibilidad</div>
              <div class="v" id="chanceLabel">1 chance</div>
              <div class="small" id="doneLine">A√∫n no usaste tu chance hoy.</div>
            </div>
            <div style="text-align:right">
              <div class="k">√öltimo c√≥digo</div>
              <div class="small" id="lastCode">‚Äî</div>
              <div class="small" id="lastTs">‚Äî</div>
            </div>
          </div>
        </div>

        <div class="box" style="margin-top:12px">
          <div class="k">Resumen para el cliente</div>
          <div class="small" style="margin-top:8px">
            ‚úÖ Eleg√≠s tu monto ‚Üí ‚úÖ Gener√°s un c√≥digo ‚Üí ‚úÖ Se valida y se aplica el beneficio con la pr√≥xima carga.
          </div>
        </div>

        <div class="box" style="margin-top:12px">
          <div class="k">Importante</div>
          <div class="small" style="margin-top:8px">
            Evitar prometer beneficios fuera de esta mec√°nica. Siempre comunicar ‚Äúsujeto a validaci√≥n‚Äù.
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Dock -->
<div class="dock">
  <button class="btn btnPrimary" id="genBtn">üßæ Generar c√≥digo</button>
  <button class="btn btnWA" id="waBtn" disabled>üì≤ Reclamar por WhatsApp</button>
  <button class="btn btnEnter" id="enterBtn">üéÆ Entrar a la plataforma</button>
</div>

<script>
/* =========================
   CONFIG (5 PCs)
   ========================= */
const PLATFORM_LINK = "https://bet300.biz"; // √∫nico para las 5

// WhatsApps gen√©ricos por PC (vos los reemplaz√°s luego)
const WP_NUMBERS = {
  pc1: "1111111111",
  pc2: "2222222222",
  pc3: "3333333333",
  pc4: "4444444444",
  pc5: "5555555555"
};

// lee ?pc=1..5 (default 1)
const params = new URLSearchParams(location.search);
const pcParam = (params.get("pc") || "1").trim();
const pcMatch = /^[1-5]$/.test(pcParam) ? pcParam : "1";
const pcKey = "pc" + pcMatch;

// normaliza para wa.me (Argentina m√≥vil por defecto)
function normalizeWP(n){
  const s = String(n).replace(/[^\d+]/g, "");
  if (s.startsWith("+549") || s.startsWith("549")) return s.replace(/^\+/, "");
  if (s.startsWith("+54"))  return "549" + s.slice(3);
  if (s.startsWith("54"))   return "549" + s.slice(2);
  return "549" + s;
}
const WP = normalizeWP(WP_NUMBERS[pcKey]);

/* =========================
   UI refs
   ========================= */
const amountRange = document.getElementById("amountRange");
const amountLabel = document.getElementById("amountLabel");
const benefitLabel = document.getElementById("benefitLabel");
const tierLine = document.getElementById("tierLine");
const meterFill = document.getElementById("meterFill");

const genBtn = document.getElementById("genBtn");
const waBtn = document.getElementById("waBtn");
const enterBtn = document.getElementById("enterBtn");

const chanceLabel = document.getElementById("chanceLabel");
const doneLine = document.getElementById("doneLine");
const lastCode = document.getElementById("lastCode");
const lastTs = document.getElementById("lastTs");

const soundToggle = document.getElementById("soundToggle");
const soundState  = document.getElementById("soundState");

const modal = document.getElementById("modal");
const mCloseX = document.getElementById("mCloseX");
const copyBtn = document.getElementById("copyBtn");
const mWA = document.getElementById("mWA");
const mEnter = document.getElementById("mEnter");
const mBenefit = document.getElementById("mBenefit");
const mAmount = document.getElementById("mAmount");
const mCode = document.getElementById("mCode");
const mTs = document.getElementById("mTs");
const toast = document.getElementById("toast");

/* =========================
   Sonido (simple)
   ========================= */
let soundOn = true;
soundToggle.addEventListener("click", () => {
  soundOn = !soundOn;
  soundState.textContent = soundOn ? "ON" : "OFF";
});
function ping(){
  if(!soundOn) return;
  try{
    const Ctx = window.AudioContext || window.webkitAudioContext;
    const ctx = new Ctx();
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.type = "sine"; o.frequency.value = 880;
    g.gain.value = 0.001;
    o.connect(g).connect(ctx.destination);
    o.start();
    g.gain.exponentialRampToValueAtTime(0.08, ctx.currentTime + 0.02);
    g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.12);
    o.stop(ctx.currentTime + 0.13);
    setTimeout(()=>ctx.close?.(), 220);
  }catch(e){}
}

/* =========================
   Formato
   ========================= */
function money(n){ return "$ " + n.toLocaleString("es-AR"); }
function pad2(n){ return String(n).padStart(2,"0"); }
function tsString(d=new Date()){
  return `${pad2(d.getDate())}/${pad2(d.getMonth()+1)}/${d.getFullYear()} ${pad2(d.getHours())}:${pad2(d.getMinutes())}`;
}
function todayKey(){
  const d = new Date();
  return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
}

/* =========================
   Beneficio progresivo
   (ajustable)
   ========================= */
let tier = "base"; // base|pro|elite

function calcBenefit(amount, tier){
  // Escala suave: a mayor monto, mayor %
  // Base: 20%..30%
  // Pro:  25%..40%
  // Elite:30%..50%
  const clamp = (v,min,max)=>Math.max(min,Math.min(max,v));

  const t = clamp((amount - 5000) / (200000 - 5000), 0, 1);

  let minP=20, maxP=30, label="Nivel Base ¬∑ Activaci√≥n r√°pida";
  if(tier==="pro"){ minP=25; maxP=40; label="Nivel Pro ¬∑ Beneficio superior"; }
  if(tier==="elite"){ minP=30; maxP=50; label="Nivel Elite ¬∑ M√°ximo beneficio"; }

  const pct = Math.round(minP + (maxP - minP)*t);
  return { pct, label };
}

function updateUI(){
  const amount = Number(amountRange.value);
  amountLabel.textContent = money(amount);

  const { pct, label } = calcBenefit(amount, tier);
  benefitLabel.textContent = `+${pct}%`;
  tierLine.textContent = label;

  // barra 20..50 => 0..100
  const pMin = 20, pMax = 50;
  const fill = Math.round(((pct - pMin) / (pMax - pMin)) * 100);
  meterFill.style.width = Math.max(6, Math.min(100, fill)) + "%";
}

document.querySelectorAll(".apill").forEach(b=>{
  b.addEventListener("click", ()=>{
    amountRange.value = b.getAttribute("data-amt");
    updateUI();
  });
});
document.querySelectorAll(".tab").forEach(t=>{
  t.addEventListener("click", ()=>{
    document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
    t.classList.add("active");
    tier = t.getAttribute("data-tier");
    updateUI();
  });
});
amountRange.addEventListener("input", updateUI);

/* =========================
   Antifraude: 1 chance / d√≠a
   ========================= */
const SALT = "bet300-beneficio-progresivo-v1";

function ensureDeviceId(){
  let id = localStorage.getItem("bp_device_id");
  if(!id){
    id = (crypto.randomUUID?.() || `${Date.now()}-${Math.random().toString(36).slice(2,10)}`);
    localStorage.setItem("bp_device_id", id);
  }
  return id;
}
const DEVICE_ID = ensureDeviceId();

async function sha256hex(msg){
  const enc = new TextEncoder().encode(msg);
  const buf = await crypto.subtle.digest("SHA-256", enc);
  return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,"0")).join("");
}
async function makeCode(amount, pct, tier){
  const base = `${DEVICE_ID}|${todayKey()}|${amount}|${pct}|${tier}|pc:${pcMatch}|${SALT}`;
  const hex = await sha256hex(base);
  return hex.slice(0,10).toUpperCase();
}

function restoreDaily(){
  const stored = localStorage.getItem("bp_date");
  const today = todayKey();
  if(stored && stored !== today){
    localStorage.removeItem("bp_done");
    localStorage.removeItem("bp_data");
    localStorage.setItem("bp_date", today);
  }else if(!stored){
    localStorage.setItem("bp_date", today);
  }
}

function refreshDoneState(){
  const done = localStorage.getItem("bp_done")==="1";
  if(done){
    chanceLabel.textContent = "0 chance";
    doneLine.textContent = "Ya usaste tu chance hoy.";
    genBtn.textContent = "‚úÖ Chance usada";
    genBtn.disabled = true;
    waBtn.disabled = false;

    const saved = JSON.parse(localStorage.getItem("bp_data") || "null");
    if(saved){
      lastCode.textContent = saved.code || "‚Äî";
      lastTs.textContent = saved.ts || "‚Äî";
    }
  }else{
    chanceLabel.textContent = "1 chance";
    doneLine.textContent = "A√∫n no usaste tu chance hoy.";
    genBtn.textContent = "üßæ Generar c√≥digo";
    genBtn.disabled = false;
    waBtn.disabled = true;
    lastCode.textContent = "‚Äî";
    lastTs.textContent = "‚Äî";
  }
}

/* =========================
   WhatsApp text
   ========================= */
function whatsappText(data){
  // texto ‚Äúoperativo‚Äù (sin prometer de m√°s)
  return `Hola! Gener√© mi c√≥digo de Beneficio Progresivo.\n\n‚Ä¢ Monto: ${money(data.amount)}\n‚Ä¢ Beneficio estimado: +${data.pct}%\n‚Ä¢ Nivel: ${data.tier.toUpperCase()}\n‚Ä¢ C√≥digo: ${data.code}\n‚Ä¢ Fecha/Hora: ${data.ts}\n\nQuiero validarlo para mi pr√≥xima carga.`;
}

/* =========================
   Modal helpers
   ========================= */
function openModal(data){
  mBenefit.textContent = `+${data.pct}%`;
  mAmount.textContent = money(data.amount);
  mCode.textContent = data.code;
  mTs.textContent = data.ts;

  copyBtn.onclick = async ()=>{
    try{
      await navigator.clipboard.writeText(data.code);
      showToast("Copiado ‚úÖ");
      ping();
    }catch(e){
      showToast("No se pudo copiar");
    }
  };

  mWA.onclick = ()=>{
    const msg = whatsappText(data);
    location.href = `https://wa.me/${WP}?text=${encodeURIComponent(msg)}`;
  };

  mEnter.onclick = ()=> window.open(PLATFORM_LINK, "_blank");

  modal.classList.add("show");
}
function closeModal(){ modal.classList.remove("show"); }
mCloseX.onclick = closeModal;
modal.addEventListener("click", (e)=>{ if(e.target===modal) closeModal(); });

function showToast(text){
  toast.textContent = text;
  toast.style.display="block";
  clearTimeout(window.__tto);
  window.__tto = setTimeout(()=>toast.style.display="none", 1400);
}

/* =========================
   Botones dock
   ========================= */
enterBtn.onclick = ()=> window.open(PLATFORM_LINK, "_blank");

waBtn.onclick = ()=>{
  const saved = JSON.parse(localStorage.getItem("bp_data") || "null");
  if(!saved){
    alert("Primero gener√° el c√≥digo.");
    return;
  }
  const msg = whatsappText(saved);
  location.href = `https://wa.me/${WP}?text=${encodeURIComponent(msg)}`;
};

genBtn.onclick = async ()=>{
  restoreDaily();
  if(localStorage.getItem("bp_done")==="1"){
    alert("Ya usaste tu chance hoy.");
    return;
  }

  const amount = Number(amountRange.value);
  const { pct } = calcBenefit(amount, tier);
  const code = await makeCode(amount, pct, tier);
  const ts = tsString(new Date());

  const data = { amount, pct, tier, code, ts, pc: pcMatch };

  localStorage.setItem("bp_done","1");
  localStorage.setItem("bp_data", JSON.stringify(data));

  refreshDoneState();
  ping();
  openModal(data);
};

/* =========================
   Countdown (fin del d√≠a)
   ========================= */
function endOfDay(){
  const n = new Date();
  const end = new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,0,0).getTime();
  return end > Date.now() ? end : new Date(n.getFullYear(),n.getMonth(),n.getDate()+1,23,59,0,0).getTime();
}
function tickCountdown(){
  const ms = endOfDay() - Date.now();
  const total = Math.max(0, Math.floor(ms/1000));
  const h = Math.floor(total/3600), m = Math.floor((total%3600)/60), s = total%60;
  document.getElementById("countdown").textContent =
    h>0 ? `${h}:${pad2(m)}:${pad2(s)}` : `${pad2(m)}:${pad2(s)}`;
}

/* =========================
   Snow (suave)
   ========================= */
function spawnSnow(){
  const wrap = document.getElementById("snow");
  wrap.innerHTML = "";
  const n = 20;
  for(let i=0;i<n;i++){
    const d = document.createElement("i");
    const left = Math.random()*100;
    const size = 3 + Math.random()*4;
    const dur = 5 + Math.random()*7;
    const delay = Math.random()*3;
    d.style.left = left + "vw";
    d.style.width = size + "px";
    d.style.height = size + "px";
    d.style.opacity = (0.25 + Math.random()*0.55).toFixed(2);
    d.style.animationDuration = dur + "s";
    d.style.animationDelay = delay + "s";
    wrap.appendChild(d);
  }
  setInterval(()=>{
    // refresca suavemente
    spawnSnow();
  }, 9000);
}

/* =========================
   Init
   ========================= */
function init(){
  // si el logo no se ve, es porque no existe la ruta. Cambi√° "logo.svg" por tu archivo real.
  // ejemplo: "assets/bet300_navidad.svg"
  restoreDaily();
  updateUI();
  refreshDoneState();
  tickCountdown();
  setInterval(tickCountdown,1000);

  spawnSnow();
}
init();
</script>
</body>
</html>
